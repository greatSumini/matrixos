---
description: 
globs: 
alwaysApply: true
---
# Project Architecture

## Directory Structure

> Emphasises **re-usability** and **domain-centric modules** without a monorepo.
> Works with Electron + Vite/React + TypeScript, managed by **pnpm**.

```text
matrix-os/
â”œâ”€ .github/                # CI / release pipelines (GitHub Actions)
â”œâ”€ public/                 # Static assets copied as-is
â”œâ”€ src/
â”‚   â”œâ”€ main/               # ğŸ‘‘ Electron â€œmainâ€ process
â”‚   â”‚   â”œâ”€ bootstrap/          # createWindow, auto-update, deep-link
â”‚   â”‚   â”œâ”€ ipc/                # Main-side IPC handlers
â”‚   â”‚   â””â”€ security/           # CSP, contextIsolation helpers
â”‚   â”œâ”€ preload/            # contextBridge APIs (1 file per domain) :contentReference[oaicite:0]{index=0}
â”‚   â”œâ”€ renderer/           # React UI (Chromium context)
â”‚   â”‚   â”œâ”€ app/                # AppShell, routing, providers
â”‚   â”‚   â”œâ”€ features/           # ğŸŒ± 1 folder = 1 feature (Tasks, Goals â€¦)
â”‚   â”‚   â”‚   â”œâ”€ tasks/
â”‚   â”‚   â”‚   â”‚   â”œâ”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€ pages/
â”‚   â”‚   â”‚   â”‚   â””â”€ hooks/
â”‚   â”‚   â”‚   â””â”€ focus/
â”‚   â”‚   â”œâ”€ ui/                 # Headless, themeable atoms/molecules
â”‚   â”‚   â””â”€ index.tsx
â”‚   â”œâ”€ domain/             # **Pure business logic â€” no Electron/React** :contentReference[oaicite:1]{index=1}
â”‚   â”‚   â”œâ”€ task/
â”‚   â”‚   â”‚   â”œâ”€ entities.ts
â”‚   â”‚   â”‚   â”œâ”€ valueObjects.ts
â”‚   â”‚   â”‚   â”œâ”€ services.ts
â”‚   â”‚   â”‚   â””â”€ policies.ts
â”‚   â”‚   â”œâ”€ goal/
â”‚   â”‚   â””â”€ focus/
â”‚   â”œâ”€ infrastructure/     # Adapters that fulfil domain interfaces
â”‚   â”‚   â”œâ”€ storage/            # electron-store, sqlite â€¦
â”‚   â”‚   â”œâ”€ notifications/      # OS toast wrappers
â”‚   â”‚   â””â”€ ipc/                # Thin wrappers for Renderer â‡„ Main
â”‚   â”œâ”€ shared/             # Cross-cutting utilities, constants, types
â”‚   â””â”€ tests/
â”‚       â”œâ”€ unit/               # Vitest on domain & utils
â”‚       â””â”€ e2e/                # Playwright desktop flows
â”œâ”€ tsconfig.base.json       # Path aliases: "@domain/*", "@ui/*"
â”œâ”€ package.json             # **single** package; pnpm scripts
â”œâ”€ pnpm-lock.yaml
â””â”€ .env                     # Build-time env vars (never secrets)
```

### Building Blocks Responsibility

- **src/main**: Bootstraps windows, security, IPC routing.
- **src/preload**: Whitelists safe APIs via `contextBridge`.
- **src/renderer**: Pure web stack (React/Vite) â€” hot reload, testable.
- **src/domain**: Entities, value objects, services: **no imports from Electron/React**.
- **src/infrastructure**: Implements repositories / gateways defined in domain.
- **src/shared**: Logger, error types, date helpers, colour tokens.
